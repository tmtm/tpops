TPOPS - Tommy's POP Server

TPOPS is POP3 server. This support RFC 1939 and is implemented by
Ruby. Supported mailbox type is Maildir. The user account and mail
message can be controled by MySQL table.

[Requirement]

  Ruby 1.6.7
	http://www.ruby-lang.org

  ruby-shadow 1.4.x	needed if using shadow password.
	http://kt-www.jaist.ac.jp/~ttate/ruby/ruby-ext.html

  bdb 0.3.1		needed if using APOP password.
	http://moulon.inra.fr/ruby/bdb.html 

  MySQL 3.23.x		needed if using MySQL authentication/mailbox.
	http://www.mysql.com

  MySQL/Ruby 2.4.x	needed if using MySQL.
	http://www.tmtm.org/mysql/ruby/

[Install]

1. extract tarball.

   ex)
	# cd /usr/local
	# tar xpvfz /tmp/tpops-0.5.0.tar.gz
	# chown -R root:root tpops-0.5.0
	# ln -s tpops-0.5.0 tpops

2. make tpops.conf. The example and default value are in
   tpops.conf.sample.

  [共通パラメータ]

    $port (110)
	port number.

    $hostname (`uname -n`.chomp)
	hostname.

    $connection_keep_time (3600)
	maximum connection keep time.

    $command_timeout (600)
	maximum time waiting command.

    $with_inetd (false)
	set true if using inetd.

    $access_log (nil)
	access log filename.

    $error_log (nil)
	error log filename.

    $pid_file (nil)
	process id filename.

    $syslog_facility (Syslog::LOG_MAIL)
	syslog facility. If it is nil, don't use syslog.

    $auth_type ('Passwd')
	authentication type. 'Passwd' or 'MySQL'.

    $error_interval (5)
	tpops wait # seconds before return error to client.

    $min_servers (5)
	minimum # of process.

    $max_servers (50)
	maximum # of process.

    $max_use (100)
	maximum session count per process.

    $max_idle (100)
	maximum idle time.

    $maildir_extended (true)
	set true if using Maildir++ file size.

    $maildir_use_filesize (true)
	set true if using file size as message size.

  [when $auth_type == 'Passwd']

    $passwd_lock_dir ('/var/tmp/tpops')
	directory keeping lock file.

    $apop_passwd_file (nil)
	APOP password filename.

  [when $auth_type == 'MySQL']

    $mysql_server (nil)
	MySQL server hostname.

    $mysql_user (nil)
	MySQL connection username.

    $mysql_pass (nil)
	MySQL user password.

    $mysql_db (nil)
	MySQL database name.

    $mysql_auth_query ('select login,passwd,uid,maildir from user where login="%s"')
	query retrieving user information.
	%s is replaced with login name.

3. If $auth_type is 'MySQL'

   Create database for TPOPS and create table using tpops_auth-mysql.sql.

    ex)
	% mysqladmin create tpops
	% mysql tpops < tpops_auth-mysql.sql

[Start]

1. Standalone

    Run /usr/local/tpops/tpops.

2. If using inetd

   Set /etc/inetd.conf:

	pop3	stream	tcp	nowait	root	/usr/local/tpops/tpops	tpops --inetd

   and kill -HUP <pid_of_inetd>.

[Starting option]

  -f filename

    read file instead of tpops.conf.

  --domain domainname

    If login name don't include any character of '@','%','+', attempt
    to authenticate with 'username@domainname'.

  --fg

    foreground.

  --port #

    port number.

  --debug

    log debug information.

  --version

    show version and exit.

  --inetd

    use inetd.

  --user username

    user name.

  --group groupname

    group name.

  --pidfile filename

    write process-id to filename.

[Signal]

SIGTERM: exit.

SIGHUP: terminate child process and force disconnecting.

SIGUSR1: terminate child process.

[Add user]

1. If $auth_type is 'Passwd' (default)

  Add user to OS. If MailboxType is 'Maildir' then ~/Maildir is used.
  If you use APOP, set $apop_passwd_file in tpops.conf. This file is
  BDB::Hash that key is loginname and value is plain password. If APOP
  is used, password is searched from this file.

2. If $auth_type is 'MySQL'

  Add user information to user table:

	uid		user ID (numeric)
	login		POP login name
	passwd		POP password
	mail		mail address
	maildir		Maildir (if using Maildir)

[Log File]

If set $access_log in tpops.conf, log to file when user logout. log
format is:

	IPaddr login-date login-time logout-date logout-time login-name login-msgs login-msgsize logout-msgs logout-msgsize

If set $syslog_facility, TPOPS write syslog. $syslog_facility is
integer or symbol like Syslog::LOG_MAIL.

[License]

This program is under Ruby license.

[History]

0.5.1	2003-01-18
	* bug fix. lock information remains when client disconnect.
	* add parameter $pid_file and --pidfile option.
	* reopen $error_log when SIGHUP.

0.5.0	2002-12-04
	* can run without tpops.conf.
	* change parameter Parameter to $parameter.
	* unsupport MySQL mailbox.
	* use TServer.
	* default value of $with_inetd is true.
	* default value of $maildir_extended, $maildir_use_filesize is
	  true.
	* enable $error_log when standalone mode.
	* add command line options.

0.4.8	2002-11-20
	* Bug fix: don't output username on log when APOP.
	* Add syslog.

[Author]

TOMITA Masahiro <tommy@tmtm.org>

$Id: README,v 1.5 2003/01/18 09:10:50 tommy Exp $
